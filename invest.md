FRM5.4.3FRM5.4.1.1 Форма операции открытия БО/ИИС - шаг 1
---------------------------------------------------------

Данная форма придет для всех сценариев на 1ом шаге (возможны только
отличия в значение некоторых элементов):

1.  для сценария opSrv;InvestmentContractsOpeningScenario;2 - у клиента
    отсутствует БО и ИИС
2.  для сценария opSrv;BrokerageInvestmentContractOpeningScenario;3 - у
    клиента уже есть открытый ИИС
3.  для сценария opSrv;IndividualInvestmentContractOpeningScenario;1 - у
    клиента отсутствует ИИС, но есть БО

** **Интерфейс****

****

\

\

\

\

\

\

\

\

\

\

\

\

\

\

**Пример экранной формы операции - шаг 1**

****Экранная спецификация формы:****

******Блок с информационным текстом:******

1.  С Минервы перед полями с данными пользователя должно будет приходить
    новое поле InfoPanel. На МП необходимо отображать данное поле
    согласно текущей реализации (см. описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-infopanel)):
2.  Для ios Поле приходит в ParameterMetaMto с id=InfoPanel
3.  Для android** **Поле приходит в StageLabelMto с
    metadata.type=InfoPanel

******Заголовок******

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-title))\
    (Текст с минервы отличается от макетов - Заключение договора
    брокерского обслуживания)**\
    **

****Кнопка отмены операции "x":****

1.  Функционал кнопки не изменяется (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-cancelbutton)).
    При нажатии происходит возврат к форме 5.4 Инвестиции**\
    **

******Кнопка "i":******

1.  Функционал кнопки не изменяется (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-hint))
2.  При нажатии на кнопку открывается стандартное Pop-up сообщение.**\
    **

****Поля с данными клиента:****

1.  Элемент отображается согласно текущей реализации отображения обычных
    полей ввода (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-StageField))
2.  Поля отображаются не доступными для ввода, если параметр readOnly=1
    / disabled=1.
3.  Поле ввода эл.почты:****\
    ****
    1.  Доступно для редактирования
    2.  Обязательно для заполнения
    3.  Формат вводимого значения должен соответствовать регулярному
        выражению, возвращаемому СИ:\
        1.  для ios в параметре pattern в RegexRestrictionMto;
        2.  для android в параметре pattern в RegexCheckMto.

4.  Поля отображаются в том порядке, в котором приходят с СИ (на макетах
    может отличаться).**\
    **

****Текст про верность данных:****

1.  Элемент отображается согласно текущей реализации отображения
    дисклеймера  (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-StageLabel) )
2.  Поле не доступно для редактирования.
3.  Если параметр не приходит, то не отображаем.**\
    **

****Кнопка "Все верно":****

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-operationbutton))\

2.  Название кнопки id/name="PASSPORT\_CONTINUE"
3.  При нажатии на кнопку выполняется  требование 1.**\
    **

****Кнопка "Данные изменились":****

1.  При нажатии на кнопку МП отправляет запрос обработки шага операции
    (см. описание шагов операции
    для [androir](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2) и
    для [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2)). При
    получении ответа Сервера осуществляется переход
    к [FRM5.4.4](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567388#id-5.4%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%B8-FRM5/4/4),
    которая в рамках данной задачи изменяется и должна отображаться в
    виде всплывающего окна.

****Функциональные требования****

****1. ****При нажатии на кнопку МП отправляет запрос обработки шага
операции
(см. [androir](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2), [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2))

1.  МП проверяет поле e-mail на соответствие регулярному выражению
    (см.п.3-с в описании элемента)\
    1.  Для ios: Если поле не прошло проверку, под ним отображается
        соответствующий текст ошибки, который берется из ответа СИ
        (параметр message в конкретном типе проверки в RestrictionMto).
    2.  Для android: Если поле не прошло проверку, то отображается
        всплывающее окно с ошибкой и под ним отображается
        соответствующий текст ошибки, который берется из ответа СИ
        (параметр msg в ValidationErrorMto для конкретного поля).

2.  Далее МП отправляет запрос обработки шага
    операции (см. [androir](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2), [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2))
    1.  Для ios: При нажатии на кнопку МП отправляет запрос
        HandleOperationRequest. При получении ответа
        Сервера OperationStageMetaMto на форме отображаются все
        полученные поля и их значения.
    2.  Для android: При нажатии на кнопку МП отправляет запрос
        HandleScenarioStageRequest. При получении ответа
        Сервера StageResponseMto на форме отображаются все полученные
        поля и их значения.

1.  Если все поля заполнены корректно, то в ответе Сервера придут данные
    по следующей форме. Осуществляется переход ко 2ому шагу операции. В
    зависимости от id операции открывается форма с соответствующими
    полями:\
    1.  Если операция открытия ИИС+БО FRM5.4.5
    2.  Если операция открытия БО (есть ИИС) FRM5.4.6
    3.  Если операция открытия ИИС (есть БО) FRM5.4.6
    4.  3. Если в ответе получены поля, требующие загрузки списков, то
        МП также должно направлять соответствующие запросы на получение
        элементов этих
        спсков (см. [android ](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A4%D0%BE%D1%80%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%B2), [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B9%D0%B4%D0%BB%D1%8F%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F(ComboBox,ListBox,%E2%80%A6)))

4. При получении ошибки (ErrorResponse) отображается окно с текстом
ошибки (согласно текущей реализации).

**FRM5.4.4FRM5.4.1.2 Форма Pop-up сообщения при изменении персональных данных **
--------------------------------------------------------------------------------

Данный экран является финальным экраном операции. Для того, чтобы
отображать его не как чек  делается следующая проверка: при получении
ответа со stage=NOTIFICATION проверяется параметр запроса stage
предыдущего шага операции (для ios это параметр stepId в
OperationStageDataMto в HandleOperationRequest. В android это stageId в
HandleScenarioStageRequest). 

1.  **Е**сли stage="INPUT", то должен отображаться чек, как всплывающее
    окно (см.). 
2.  Если stage="CONFIRMATION", то должен отображаться чек с картинкой и
    кнопкой пополнения счета (см.).

********

****Пример экранной формы Pop-up сообщения при изменении персональных
данных (a - ios, b - android)****

******Экранная спецификация формы******

******Заголовок:******

1.  Текст для отображения в заголовке всплывающего сообщения приходит
    как текст для обычного заголовка формы:\
    1.  Для ios из параметра title в OperationStageMetaMto.

    2.  Для android из параметра name в titles

2.  Текст располагается в соответствии с текущей реализацией таких
    всплывающих окон

******Текст сообщения:******

1.  Текст берется из параметра Description\
    1.  Для ios из параметра Description в OperationStageMetaMto.

    2.  Для android из параметра Description в titles

2.  Текст располагается в соответствии с текущей реализацией таких
    всплывающих окон

******Кнопка "Нет":******

1.  Кнопка должна дублировать поведение кнопки "х", при нажатии операция
    должна завершаться и должен происходить возврат к форме [5.4
    Инвестиции\#FRM5.4.1](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567388#id-5.4%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%B8-FRM5.4.1).
2.  Значение кнопки "Нет", прописываем в коде приложения

******Кнопка "Да":******

1.  При нажатии на кнопку операция прекращается, происходит переход по
    ссылке
    "[https://www.vtb.ru/o-banke/kontakty/otdeleniya](https://www.vtb.ru/o-banke/kontakty/otdeleniya)"
2.  Значение кнопки "Да", прописываем в коде приложения

**FRM5.4.5FRM5.4.1.3 Форма операции открытия брокерского счета  - шаг 2**
-------------------------------------------------------------------------

Данная форма придет 2ым шагом для операции по сценарию
opSrv;InvestmentContractsOpeningScenario;2 - у клиента отсутствует БО и
ИИС

Интерфейс

****

****Пример экранной формы операции - шаг 2 **(1 ios, 2 android)******

****Экранная спецификация формы****

****Заголовок:\
****

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-title))
2.  (текст с минервы отличается от макетов - Заключение договора
    брокерского обслуживания)

****Кнопка "i":****

1.  Функционал кнопки не изменяется (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-hint))
2.  При нажатии на кнопку открывается стандартное Pop-up сообщение с
    текстом.

****Кнопка "Назад":****

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-operationbutton))\
2.  Название кнопки id/name=Back
3.  При нажатии на кнопку выполняется  [требование
    2](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567388#id-5.4%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%B8-FRM5.4.5FR5).

****Блок с информационным текстом:****

1.  С Минервы перед полями с данными пользователя должно будет приходить
    новое поле InfoPanel.
2.  На МП необходимо отображать данное поле согласно текущей реализации
    (см. описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-infopanel)):
    1.  Для ios Поле приходит в ParameterMetaMto с id=InfoPanel
    2.  Для android Поле приходит в StageLabelMto с
        metadata.type=InfoPanel

****Кнопка "Продолжить":****

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-operationbutton))
2.  Название кнопки id/name=CONTINUE
3.  При нажатии на кнопку выполняется  [требование
    1](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567388#id-5.4%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%B8-FRM5.4.5FR4).

****Кнопка отмены операции "x":****

1.  Функционал кнопки не изменяется (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-cancelbutton))

****Список с радиобатонами и связанными полями:****

1.  Элемент отображается согласно текущей реализации отображения полей
    со списком:\
    1.  Для ios см.описание полей с  hint=RadioGroup в [общих
        требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-RadioGroup).
    2.  Для android см.описание полей со списком в [общих
        требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-listTicket).

2.  В ответе СИ по данному полю приходит:\
    1.  Для ios приходит ParameterMetaMto, где заполнен valueList с
        listId=CONTRACT\_TYPES и hint=RadioGroup.
    2.  Для android приходит StageFieldMto с
        заполненным listTicket=CONTRACT\_TYPES

3.   В отображаемом списке RadioGroup у элементов с
    типом CompositeListEntryMto (полученных в ответе на запрос элементов
    списка StageElementValuesListResponse) необходимо проверять параметр
    linkedGroupName, в котором передается имя группы элементов операции
    (ios - id в GroupParameterMetaMto, android - name в StageGroupMto),
    которые связаны с этим элементом и должны отображаться под ним.\
    1.  у элемента id="NeedAdditionalAccount" приходит
        linkedGroupName="AdditionalAccountGroup"
    2.  у элемента id="NoAdditionalAccount" приходит
        linkedGroupName="NoAdditionalAccountGroup"

4.  У групп полей (ios - GroupParameterMetaMto, android - StageGroupMto)
    приходящих в операции необходимо проверять
    параметр linkedToListItem. \
    1.  Если linkedToListItem=true/1, то поля данной группы связны с
        элементом выпадающего списка. 

5.  Таким образом в соответствии с макетами:\
    1.  под элементом с id="NeedAdditionalAccount" будет отображаться
        элемент CheckBox, который приходит в группе
        с id/name = AdditionalAccountGroup.
    2.  под элементом с id="NoAdditionalAccount" будет отображаться
        текстовый элемент, который приходит в группе с id/name
        = NoAdditionalAccountGroup.

6.  Отображение элементов может отличаться от макетов в связи с
    особенностями реализации.

****Текст "Определение ИИС":****

1.  Элемент отображается согласно текущей реализации отображения
    дисклеймера  (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-StageLabel) )
2.  Поле не доступно для редактирования.
3.  Если параметр не приходит, то не отображаем.

****Текст про только один ИИС:****

1.  Элемент отображается согласно текущей реализации отображения
    дисклеймера  (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-StageLabel) )
2.  Поле не доступно для редактирования.
3.  Если параметр не приходит, то не отображаем.
4.  В данном тексте будут приходить бб код [color=red], приложение
    должно уметь его обрабатывать.
5.  При тестировании проверить - при не выбранном чекбоксе и отправке
    запроса, в ответ от Минервы должен будет приходить этот же экран, с
    этими же полями, только в поле с данным текстом будет приходить этот
    же текст с bb кодом [color=red].

****Чек бокс:****

1.  Элемент отображается согласно текущей реализации отображения
    элементов с hint=CheckBox в виде переключателя (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-CheckBox)).
2.  В ответе СИ по данному полю
    приходит name=NoOtherAccountsConfirmation.

******\
 Функциональные требования******

1.  При нажатии на кнопку МП отправляет запрос обработки шага операции
    (см. описание шагов операции
    для [androir](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2) и
    для [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2)). При
    получении ответа Сервера по следующему шагу операции осуществляется
    переход к .
2.  При нажатии на кнопку МП отправляет запрос обработки шага операции
    (см. описание шагов операции
    для [androir](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027103#id-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9%D0%BD%D0%B0Android-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B51.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2) и
    для [ios](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=70027205#id-9.1%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%D1%82%D0%B8%D0%BF%D0%BE%D0%B2%D0%BE%D0%B9%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B52.%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2)). При
    получении ответа Сервера по следующему шагу операции осуществляется
    переход к FRM5.4.4

****FRM5.4.6**FRM5.4.1.4 Форма операции открытия брокерского счета - шаг 3/ шаг 2**
-----------------------------------------------------------------------------------

Данная форма придет для разных сценариев на разном шаге (возможны только
отличия в значение некоторых элементов):

1.  3им шагом для сценария opSrv;InvestmentContractsOpeningScenario;2
    - у клиента отсутствует БО и ИИС
2.  2ым шагом для сценария
    opSrv;BrokerageInvestmentContractOpeningScenario;3 - у клиента уже
    есть открытый ИИС
3.  2ым шагом для
    сценария opSrv;IndividualInvestmentContractOpeningScenario;1 - у
    клиента отсутствует ИИС, но есть БО

Для андройда нет макета. Отображение должно соответствовать текущей
реализации соответствующих элементов, описание см.ниже в таблице.
Реализация может отличаться от макета на рисунка ниже.

******** {style="text-align: center;"}
--------

****1,2 - шаг 3 для сценария открытия ИИС+БО, 3 - шаг 2 для сценария
открытия ИИС, 4 - шаг 2 для сценария открытия БО\
****

********

****1,2 - шаг 3 для сценария открытия ИИС+БО, 3 - шаг 2 для сценария
открытия ИИС, 4 - шаг 2 для сценария открытия БО****

******Пример экранной формы операции открытия брокерского счета (у
клиента отсутствует БО и ИИС) - шаг 3 (a - ios, b - android)******

******Экранная спецификация формы******

******Блок с информационным текстом:******

1.  С Минервы перед текущими полями должно будет приходить новое поле
    InfoPanel.
2.  На МП необходимо отображать данное поле согласно текущей реализации
    (см. описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-infopanel)):
    1.  Для ios Поле приходит в ParameterMetaMto с id=InfoPanel
    2.  Для android Поле приходит в StageLabelMto с
        metadata.type=InfoPanel

******Текст под чекбоксом (для сценария открытия ИИС):******

1.  В данном тексте будут приходить бб код [color=red], приложение
    должно уметь его обрабатывать.
2.  При тестировании проверить - при не выбранном чекбоксе и отправке
    запроса, в ответ от Минервы должен будет приходить этот же экран, с
    этими же полями, только в поле с данным текстом будет приходить этот
    же текст в bb кодом [color=red].

****** Сворачиваемый элемент "Тарифы":******

1.  С Минервы будет приходить новый элемент StageCollapsibleCaptionMto,
    который на приложениях уже обрабатывается и отображается в виде
    заголовка, с возможностью свертывания и развертывания списка
    связанных элементов  (см.описание полей в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-StageCollapsibleCaption) ).
2.  Свертываемые поля будут приходить в группе с id/name = значению в
    параметре elementId в StageCollapsibleCaptionMto (=TariffsGroup).

****Блок "Брокерская комиссия"(таблица и ссылка):****

Изменится состав элементов, в котором приходили данные - табличная часть
будет приходить отдельно от ссылки.

1.  Поле со ссылкой не изменяется (приходит отдельный StageLabel с
    текстом с bb кодом и отображаем как обычную ссылку)
2.  Табличная часть будет приходить в новом типе StageDataTableMto,
    который приложение уже умеет обрабатывать (см.пример [операции "ФСГ
    Тестовый"](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=68457245),
    с id=819465385)
3.  У данного элемента необходимо будет проверять новый параметр
    Metadata, и в нем поле Type.\
    1.  Если Type=Common, то отображение должно быть таким же, как в
        текущей реализации (см.п.1) 
    2.  Если Type=TermsTable, то отображение должно быть как на макетах
        для текущей задачи (см.п.3)

4.  Новое табличное отображение:
    1.  Заголовок из параметра caption отображаем как текущий заголовок
        обычного поля ввода (ios - label в ParameterMetaMto, android -
        name в TitlesMto)
    2.  Строки и столбцы таблицы отображаем в соответствии с макетами из
        парамтеров rows и columns
    3.  Значения в ячейках не должны быть редактируемыми

****Блок "Комиссия депозитария"(таблица и ссылки):****

1.  Отображение изменяется аналогично блоку "Брокерская комиссия"

****Блок "Документы":****

1.  Отображение данного поля не изменяется.

****Блок "Согласие с условиями":****

1.  Будет приходить отдельный StageLabel с текстом с bb кодами, которые
    нужно обрабатывать также как в блоке "Документы".

****Чекбокс:****

1.  Отображение данного поля не изменяется.

****Кнопка "Назад":****

1.  Кнопка не должна будет отображаться как стандартная кнопка операции,
    т.к. была [доработка в скраме "Платежи и
    переводы"](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=69176600#RS-%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D1%8B-US%C2%A07%D0%9A%D0%BD%D0%BE%D0%BF%D0%BA%D0%B0%22%D0%9D%D0%B0%D0%B7%D0%B0%D0%B4%22) (если
    приходит кнопка назад, то она не отображается, а при нажатии на
    стрелку "\<" происходит возврат к предыдущему экрану) . Т.е. в
    данной задаче отдельной доработки не требуется.

****Кнопка "Выполнить":****

1.  Появляется после отправки смс.
2.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=68454407#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-operationbutton))\
3.  При нажатии осуществляется переход к:\
    - следующему шагу операции открытия
    БО/ИИС  [FRM5.4.7](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567388#id-5.4%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D0%B8-FRM5.4.10)\
    - следующему шагу операции покупки ценных
    бумаг [FRM5.4.9.](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=90092471#id-5.4.1%D0%9E%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5%D0%91%D0%9E/%D0%98%D0%98%D0%A1-FRM5.4.9.)

**FRM5.4.7FRM5.4.1.5 Форма чека**
---------------------------------

Данный экран является финальным экраном операции. Для того, чтобы
отображать его не как чек  делается следующая проверка: при получении
ответа со stage=NOTIFICATION проверяется параметр запроса stage
предыдущего шага операции (для ios это параметр stepId в
OperationStageDataMto в HandleOperationRequest. В android это stageId в
HandleScenarioStageRequest). 

1.  Если stage="INPUT", то должен отображаться чек, как всплывающее окно
    (см.). 
2.  Если stage="CONFIRMATION", то должен отображаться чек с картинкой и
    кнопкой пополнения счета (см.).

********

**a- для операции открытия только ИИС (для сценария с
id=opSrv;IndividualInvestmentContractOpeningScenario;1) - ios/android**\
****

********

**b - для операции открытия БО+ИИС, когда открываем и БО и ИИС -
ios/android**

********

**с - для операции открытия БО+ИИС, когда открываем только БО и операции
открытия БО - ios/android**

******Пример экранной формы чек (a- для операции открытия только ИИС, b-
для остальных операций)******

******Экранная спецификация формы******

******Заголовок:\
******

1.  Функционал отображения элемента не изменяется (см.описание полей
    в [общих
    требованиях](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567315#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-title))

******Кнопка "x":******

1.  Отображение кнопки не изменяется (см.описание полей в [общих
    требованиях](https://support.bsc-ideas.com/confl/pages/viewpage.action?pageId=81567315#id-9.%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-CANCEL))
2.  При нажатии на кнопку, приложение осуществляется переход к главной
    форме  [FRM2.1](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=68454386#id-2.%D0%93%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0-FRM2.1) (информация
    по продуктам не перезапрашиваются, т.к. изменения произойдут только
    через какое-то время и обновятся на приложении по кеш-токину).

******Фон:******

1.  Представляет собой картинку по всему размеру экрана (хранится на
    приложении).
2.  Картинка подставляется разная, в зависимости от значения параметра
    (android - stage в NotificationStageResponseMto; ios - stepId в
    OperationStageMetaMto):
    1.  Если придет значение IndividualContract\_NOTIFICATION (открытие
        ИИС) или BrokerAndIndividualContracts\_NOTIFICATION(открытие БО
        и ИИС), то отображаем фон с процентами (см.рисунок b - FRM5.4.7)
    2.  Если придет BrokerContract\_NOTIFICATION(открытие БО без ИИС),
        то отображаем фон с графиком(см.рисунок c - FRM5.4.7)

    1.  1.  На данном фоне круговой элемент с 13% и с лентой заверстан
            отдельно от основного фона и располагаться по середине
            экрана.

******Текст под заголовком:******

1.  Будет приходить новый элемент name/id=REPLENISH\_NEW\_LABEL
2.  По этому name/id нужно идентифицировать этот элемент и отображать
    под заголовком.
3.  Формат отображения текста такой же, как и у текста в [текущей
    реализации](http://intra.bscmsc.ru/wiki/pages/viewpage.action?pageId=69184125#RSBR-12714%D0%9E%D1%84%D0%BE%D1%80%D0%BC%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%BE%D0%B2%D0%BD%D0%B0%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D1%81%D0%BA%D0%BE%D0%B5%D0%BE%D0%B1%D1%81%D0%BB%D1%83%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%B2%D0%9C%D0%BE%D0%B1%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D0%BC%D0%B1%D0%B0%D0%BD%D0%BA%D0%B5-2.4.10.2%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F).
4.  Необходимо добавить обработку bb кодов (по
    текущему [списку](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=65766333)),
    которые могут приходить в данном тексте. Например текста
    см. [https://support.bsc-ideas.com/jira/browse/P20009346-5007](https://support.bsc-ideas.com/jira/browse/P20009346-5007)

******Текст над кнопкой:******

1.  Будет приходить новый элемент name/id=REPLENISH\_NEW\_LABEL\_SECOND
2.  По этому name/id нужно идентифицировать этот элемент и отображать
    внизу экрана над кнопкой.
3.  Текст отображается белым, выравненным по центру, размер шрифта такой
    же, как у текста под заголовком на этой же форме.
4.  Необходимо добавить обработку bb кодов (по
    текущему [списку](http://intra.b-s-c.ru/wiki/pages/viewpage.action?pageId=65766333)),
    которые могут приходить в данном тексте. Например текста
    см. [https://support.bsc-ideas.com/jira/browse/P20009346-5007](https://support.bsc-ideas.com/jira/browse/P20009346-5007)

******Кнопка "Пополнить ИИС"/ "Пополнить брокерский счет":******

1.  Текущую кнопку перехода к операции пополнения созданного счета нужно
    убрать, т.к. мы рисовали ее сами на приложениях.
2.  С Минервы будет приходить кнопка с name/id=REPLENISH\_NEW  (android
    в StageCommandMto, ios в ActionMetaMto) по которой будет
    осуществляться запуск соответствующей операции.
3.  Данная кнопка должна отображаться внизу экрана, также как текущая в
    соответствии с макетами.
4.  Повторное нажатие кнопки должно быть недоступно (лоудер**)**

**\
**
